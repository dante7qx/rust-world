/**
 * ç”¨æˆ·ç»“æ„ä½“
 */
#[derive(Debug)]
#[allow(dead_code)]
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
/** å…ƒç»„ç»“æ„é¢˜ */
#[allow(dead_code)]
struct Color(i32, i32, i32);

fn main() {
    // ä¸‹åˆ’çº¿å¼€å¤´å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡ã€å‡½æ•°
    // format_print();
    // var_bind_destruct();
    // println!("è®¡ç®—ç»“æœ: {}", statement_expression());
    // ownership();
    // complex_type();
    flow_control();

    // dead_end();
}

/**
 * æ ¼å¼åŒ–è¾“å‡º
 */
fn _format_print() {
    let days = String::from("31å¤©");
    println!("{} days", days);

    println!(
        "{subject} {verb} {object}",
        object = "the lazy dog",
        subject = "the quick brown fox",
        verb = "jumps over"
    );

    println!("Base 10:               {}", 69420); //69420
    println!("Base 2 (binary):       {:b}", 69420); //10000111100101100
    println!("Base 8 (octal):        {:o}", 69420); //207454
    println!("Base 16 (hexadecimal): {:x}", 69420); //10f2c
    println!("Base 16 (hexadecimal): {:X}", 69420); //10F2C

    println!("{number:>5}", number = 1);

    println!("{number:0<5}", number = 1);

    println!("{number:0>width$}", number = 1, width = 5);

    println!("My name is {0}, {1} {0}", "Bond", "Ann");

    let number: f64 = 1.0;
    let width: usize = 5;
    println!("{number:>width$}");
}

/**
 * å˜é‡ç»‘å®šä¸è§£æ„
 */
fn _var_bind_destruct() {
    // Rust çš„å˜é‡åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦è®¾ç½®ç»‘å®šå€¼ï¼Œå°±ä¸èƒ½å†ä¿®æ”¹ã€‚è‹¥è¦æ”¹å˜å˜é‡ï¼Œåˆ™éœ€è¦ç”¨å…³é”®å­— mut å£°æ˜ let mut x = 10; ï¼ˆmut åªèƒ½ä¿®æ”¹å˜é‡å€¼ï¼Œä¸èƒ½ä¿®æ”¹å˜é‡ç±»å‹ï¼‰
    let x = 5;
    let mut y = 10;
    println!("x => {}, y => {}", x, y);
    y = 20;
    println!("x => {}, y => {}", x, y);

    // å˜é‡è§£æ„
    let (mut a, b) = ("ä½ å¥½", 101);
    println!("a = {:?}, b = {:?}", a, b);
    a = "ğŸ‘‹";
    println!("a = {:?}, b = {:?}", a, b);

    // å•å…ƒç±»å‹ () ä½œä¸ºä¸€ä¸ªå€¼ç”¨æ¥å ä½ï¼Œä½†æ˜¯å®Œå…¨ä¸å ç”¨ä»»ä½•å†…å­˜
}

/**
 * è¯­å¥ï¼ˆstatementï¼‰å’Œè¡¨è¾¾å¼ï¼ˆexpressionï¼‰
 *
 * è¯­å¥ï¼ˆstatementï¼‰: ä¼šæ‰§è¡Œä¸€äº›æ“ä½œä½†æ˜¯ä¸ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œç»“å°¾åŒ…å«åˆ†å·(;)
 * è¡¨è¾¾å¼ï¼ˆexpressionï¼‰: è¡¨è¾¾å¼ä¼šåœ¨ä¸€äº›æ“ä½œåè¿”å›ä¸€ä¸ªå€¼ï¼Œç»“å°¾ä¸èƒ½åŒ…å«åˆ†å·(;)ã€‚è¡¨è¾¾å¼å¦‚æœä¸è¿”å›ä»»ä½•å€¼ï¼Œä¼šéšå¼åœ°è¿”å›ä¸€ä¸ª ()
 *
 * æ³¨æ„ç‚¹ï¼šè¡¨è¾¾å¼ä¸èƒ½åŒ…å«åˆ†å·ã€‚è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¸€æ—¦ä½ åœ¨è¡¨è¾¾å¼ååŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±ä¼šå˜æˆä¸€æ¡è¯­å¥ï¼Œå†ä¹Ÿä¸ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè¯·ç‰¢è®°ã€‚
 */
fn _statement_expression() -> i32 {
    let (x, y) = (5, 78);
    x + y
}

/**
 * æ‰€æœ‰æƒ
 * 1. Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
 * 2. ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
 * 3. å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)
 *
 * ä»»ä½•åŸºæœ¬ç±»å‹çš„ç»„åˆå¯ä»¥ Copyï¼Œä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹æ˜¯å¯ä»¥ Copy çš„ã€‚å¯å˜å¼•ç”¨ &mut T æ˜¯ä¸å¯ä»¥ Copyçš„ã€‚
 *
 * å¼•ç”¨å’Œå€Ÿç”¨
 * 1. å¼•ç”¨ & æŒ‡å‘çš„å€¼é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„
 * 2. åŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨
 * 3. å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨
 * 4. æ‚¬å‚å¼•ç”¨ï¼Œæ‚¬å‚å¼•ç”¨ä¹Ÿå«åšæ‚¬å‚æŒ‡é’ˆï¼Œæ„æ€ä¸ºæŒ‡é’ˆæŒ‡å‘æŸä¸ªå€¼åï¼Œè¿™ä¸ªå€¼è¢«é‡Šæ”¾æ‰äº†ï¼Œè€ŒæŒ‡é’ˆä»ç„¶å­˜åœ¨ï¼Œå…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½ä¸å­˜åœ¨ä»»ä½•å€¼æˆ–å·²è¢«å…¶å®ƒå˜é‡é‡æ–°ä½¿ç”¨ã€‚
 * 5. åŒä¸€æ—¶åˆ»ï¼Œä½ åªèƒ½æ‹¥æœ‰è¦ä¹ˆä¸€ä¸ªå¯å˜å¼•ç”¨, è¦ä¹ˆä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨ï¼›å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„
 */
fn _ownership() {
    let s1 = String::from("hello");
    let s2 = &s1; // æ ˆæŒ‡é’ˆç§»åŠ¨ moveï¼Œs1 æˆä¸ºæ— æ•ˆçš„å¼•ç”¨
    let s3 = s1.clone(); // å…‹éš† cloneï¼ˆæ·±æ‹·è´ï¼‰

    println!("{} - ({}->{}) - {}, world!", s1, s2, *s2, s3);

    let x: &str = "hello, world";
    let y = x; // æ‹·è´
    println!("{},{}", x, y);

    let mut s = String::from("å¯å˜å€¼");
    let rs = &mut s;
    println!("==> {}", rs);
    _change(rs);
    println!("==> {}", s);
}

fn _change(str: &mut String) {
    str.push_str(", åŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨");
}

/**
 * å¤åˆç±»å‹
 *
 * å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ã€‚å°±å­—ç¬¦ä¸²å­—é¢å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæœ€ç»ˆå­—é¢å€¼æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆï¼Œè¿™ä¸»è¦å¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚
 *
 */
fn _complex_type() {
    println!("========================= å­—ç¬¦ä¸² ================================");
    let s = String::from("Hello world");
    let len = s.len();
    // åˆ‡ç‰‡
    let hello = &s[0..5];
    let world = &s[6..len]; // æˆ–è€… &s[6..]
    println!("==> {} - {}", hello, world);

    let a = [1, 2, 3, 4, 5];
    let slice = &a[1..3];
    assert_eq!(slice, &[2, 3]);

    // å­—ç¬¦ä¸²é‡‡ç”¨UTF-8ç¼–ç ï¼Œä¸€ä¸ªæ±‰å­—å 3ä¸ªå­—èŠ‚
    let mut ch_str = String::from("ä¸­å›½äºº");
    ch_str.push_str("ï¼");
    println!("{} ==> {}", ch_str, &ch_str[0..3]);
    ch_str.clear();
    println!("Clearåï¼š{}", ch_str);

    // è¿æ¥å­—ç¬¦ä¸²
    let string_append = String::from("hello ");
    let string_rust = String::from("rust");
    // &string_rustä¼šè‡ªåŠ¨è§£å¼•ç”¨ä¸º&str
    let result = string_append + &string_rust;
    let mut result = result + "!";
    result += "!!!";

    println!("è¿æ¥å­—ç¬¦ä¸² + -> {}", result);

    // éå† UTF-8 å­—ç¬¦ä¸²
    for c in "ä¸­å›½äºº".chars() {
        println!("{}", c);
    }

    println!("========================= å…ƒç»„ =================================");
    // å…ƒç»„æ˜¯ç”±å¤šç§ç±»å‹ç»„åˆåˆ°ä¸€èµ·å½¢æˆçš„ï¼Œå› æ­¤å®ƒæ˜¯å¤åˆç±»å‹ï¼Œå…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå…ƒç»„ä¸­å…ƒç´ çš„é¡ºåºä¹Ÿæ˜¯å›ºå®šçš„
    let tup = (500, 6.4, 100);
    let (_x, y, _z) = tup;
    println!("The value of y is: {}, z is: {}", y, tup.2);

    println!("========================= ç»“æ„ä½“ ================================");
    // 1. åˆå§‹åŒ–å®ä¾‹æ—¶ï¼Œæ¯ä¸ªå­—æ®µéƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ–
    // 2. åˆå§‹åŒ–æ—¶çš„å­—æ®µé¡ºåºä¸éœ€è¦å’Œç»“æ„ä½“å®šä¹‰æ—¶çš„é¡ºåºä¸€è‡´
    let mut user1 = User {
        email: String::from("someone@example.com"),
        username: String::from("ä½†ä¸"),
        active: true,
        sign_in_count: 1,
    };
    user1.email = String::from("dante7qx@gmail.com");
    println!("ç”¨æˆ·1 -> {:?}", user1);

    // ç»“æ„ä½“æ›´æ–°è¯­æ³•
    // æŠŠç»“æ„ä½“ä¸­å…·æœ‰æ‰€æœ‰æƒçš„å­—æ®µè½¬ç§»å‡ºå»åï¼Œå°†æ— æ³•å†è®¿é—®è¯¥å­—æ®µï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®å…¶å®ƒçš„å­—æ®µã€‚(user1 çš„ email å°±æ— æ³•è®¿é—®äº†)
    let user2 = User {
        username: String::from("å°¤å¨œ"),
        ..user1
    };
    println!("ç”¨æˆ·2 -> {:?}", user2);

    let black = Color(0, 0, 0);
    println!("é»‘è‰² -> {}", black.0);

    println!("========================= æ•°ç»„ =================================");
    let months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
    ];
    println!("æœˆä»½ => {:?} \r\n6-9æœˆ: {:?}", months, &months[5..8]);
}

/**
 * å½“ç”¨ ! ä½œå‡½æ•°è¿”å›ç±»å‹çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°æ°¸ä¸è¿”å›( diverge function )ï¼Œç‰¹åˆ«çš„ï¼Œè¿™ç§è¯­æ³•å¾€å¾€ç”¨åšä¼šå¯¼è‡´ç¨‹åºå´©æºƒçš„å‡½æ•°
 */
fn _dead_end() -> ! {
    panic!("ä½ å·²ç»åˆ°äº†ç©·é€”æœ«è·¯ï¼Œå´©æºƒå§ï¼");
}

/**
 * æµç¨‹æ§åˆ¶
 *
 */
fn flow_control() {
    println!("========================= è¡¨è¾¾å¼ ================================");
    let condition = true;
    let number = if condition { 5 } else { 6 };
    println!("number is: {}", number);

    let n = 28;
    if n % 4 == 0 {
        println!("è¢«4æ•´é™¤ï¼");
    } else if n % 3 == 0 {
        println!("è¢«3æ•´é™¤ï¼");
    } else if n % 2 == 0 {
        println!("è¢«2æ•´é™¤ï¼");
    } else {
        println!("ä¸èƒ½è¢«4ã€3ã€2æ•´é™¤ï¼");
    }

    for i in 1..=5 {
        println!("{}", i)
    }

    let a = [4, 3, 2, 1];
    for (i, v) in a.iter().enumerate() {
        println!("ç¬¬{}ä¸ªå…ƒç´ æ˜¯{}", i + 1, v);
    }

    let mut connter = 0;
    loop {
        connter += 1;
        if connter == 5 {
            println!("è·³å‡ºloopå¾ªç¯ã€‚");
            break;
        }
        
        println!("å½“å‰è®¡æ•°: {}", connter);
    }

    // æ¨¡å¼åŒ¹é…
    /*
    match target {
        æ¨¡å¼1 => è¡¨è¾¾å¼1,
        æ¨¡å¼2 => {
            è¯­å¥1;
            è¯­å¥2;
            è¡¨è¾¾å¼2
        },
        _ => è¡¨è¾¾å¼3    ï¼ˆé»˜è®¤æ–¹å¼ï¼‰
    }
    */
    let dire = "WEST";
    match dire {
        "EAST" => println!("ä¸œæ–¹"),
        "WEST" => println!("è¥¿æ–¹"),
        "SOURTH" => println!("å—æ–¹"),
        "NORTH" => println!("åŒ—æ–¹"),
        _ => println!("æœªçŸ¥æ–¹å‘"),
    };
}
